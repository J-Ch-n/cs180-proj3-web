<!-- Referenced https://www.youtube.com/watch?v=i7uJAOFEd4g -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>CS180 Proj 3</title>
        <link rel="stylesheet" href="https://cdn.lineicons.com/4.0/lineicons.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        
        <div class="wrapper">
            <div id="sidebar"> 
                
                <div class="sidebar-logo">
                    <a href="#title">Navigation</a>
                </div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#part1">
                                <span>Part 1</span>
                            </a>
                        </button>
                    </li>
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#part2">
                                <span>Part 2</span>
                            </a>
                        </button>
                    </li>
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#part3">
                                <span>Part 3</span>
                            </a>
                        </button>
                    </li>
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#part4">
                                <span>Part 4</span>
                            </a>
                        </button>
                    </li>
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#part5">
                                <span>Part 5</span>
                            </a>
                        </button>
                    <li class="sidebar-nav-item">
                        <button type="button" class="btn btn-light">
                            <a href="#bw">
                                <span>Bells & Whistles</span>
                            </a>
                        </button>
                    </li>
                </ul>
            </div>
            <div class="main">
              <h1 id="title"> CS180 Project 3 </h1>
                <h2 id="part1"> Part 1: Defining Corrrespondences </h2>
                  <div class="text-container"> 
                    <p> In this part, I used the provided 
                      <a href=https://cal-cs180.github.io/fa23/hw/proj3/tool.htmltool>tool</a>
                      to define correspondences between my face and my friend's face. After finding the set of 
                      correspondences, I averaged the points from face 1 and the points from face 2, after which
                      I calculated the Delaunay triangulation based on the average. I then overlayed the triangulation 
                      points and edges on the original photos. Here are the resuls
                    </p>
                    
                    <div class="image_container"> 
                        <div class=image>
                            <figure> 
                              <img src="output/img1_overlay.jpeg", width="400">
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                              <img src="output/img2_overlay.jpeg", width="400">
                            </figure>
                        </div>
                    </div>
                  </div>
                <h2 id="part2"> Part 2: Computing the "Mid-way Face" </h2>

                    <p> 
                        In this section, I used the Delaunay triangles to define a forward and an inverse transformation between image 1/2 and the 
                        halfway image. First, I computed the halfway image's positioning points by taking average of the points from either image. Second,
                        with the target face structure found, I computed a forward and a inverse transformation for each pair of corresponding triangles between 
                        the original image and the halfway image. I did this for both image 1 to halfway and image 2 to halfway. Finally, I used the inverse transformations
                        to select color values from the original images, after which I averaged the two halfway images (image1 - halfway and image2 - halfway) and 
                        created the morphed halfway face. The results are as follow.
                    </p>

                    <div class="image_container"> 
                        <div class=image>
                            <figure> 
                                <img src="data/my_photo.jpg", width="200">
                                <figcaption class="caption"> 
                                    My Face Original
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="data/yifan_photo.jpg", width="200">
                                <figcaption class="caption"> 
                                    My Friend's Face Original
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/mid_image_1.jpeg", width="400">
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/mid_image_2.jpeg", width="400">
                            </figure>
                        </div>
                        <div class="image">
                            <figure> 
                                <img src="output/mid_image.jpeg", width="400">
                            </figure>
                        </div>
                    </div>

                <h2 id="part3"> Part 3: The Morph Sequence </h2>
                    <p>
                        In this part, I completed the morphing processing by running the previous part with different warp and dissolve fractions. I set up a arithmetic sequence from 0 to 1 with the 
                        1 / 60 as the step size, with which I repeatedly called the morph function from part 2 with the warp and dissolve fractions incrementally chosen from the sequence. Then, I combined 
                        all the results and created a animated GIF. Here is the result.
                    </p>

                    <div class=image>
                        <figure> 
                        <img src="output/yifan/me_to_yifan.gif", width="200">
                        </figure>
                    </div>
                <h2 id="part4"> Part 4: The "Mean face" of a population </h2>
                    <p> 
                        In this part, I used the FEI database to compute its average face. To ensure the completeness of the morphed photos, I also manually added 
                        points at each corner for all annotated faces I then morphed all faces into the mean face, using the morph sequence described in part 3. Finally,
                        I warped my face into the average geometry and the average face into my geometry, which was achieved by keeping the dissolving fraction to 0 or 1 depending
                        on which target I'm using. Here are the results.
                    </p>
                    
                    <div class="image_container"> 
                        <div class=image>
                            <figure> 
                                <img src="output/mean_face.jpeg", width="200">
                                <figcaption class="caption"> 
                                Mean Face
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/faces_to_mean/5b.jpg.gif", width="200">
                                <figcaption class="caption"> 
                                    Face 5b to Mean Face
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/faces_to_mean/105a.jpg.gif", width="200">
                                <figcaption class="caption"> 
                                    Face 105a to Mean Face
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/faces_to_mean/200a.jpg.gif", width="200">
                                <figcaption class="caption"> 
                                    Face 200a to Mean Face
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/my_face_to_mean/mean_to_my_geom.jpg", width="400">
                                <figcaption class="caption"> 
                                    Mean Face to My Geometry
                                </figcaption>
                            </figure>
                        </div>
                        <div class=image>
                            <figure> 
                                <img src="output/my_face_to_mean/my_face_to_geom.jpg", width="400">
                                <figcaption class="caption"> 
                                    My Face to Mean Geometry
                                </figcaption>
                            </figure>
                        </div>
                    </div>
                <h2 id="part5"> Part 5: Caricatures: Extrapolating from the mean </h2>
                    <p> 
                        In this part, I extrapolated my face from the mean face from the previous part to create a caricature of myself. To be honest,
                        my face, when warped into the mean geometry, was funny enough. However, I wanted to deliver a more dramatic caricature. To this 
                        end, I used a warp fraction of 1.8 and a dissolve fractionof 0.9 to morph my face into the mean face, thus creating a hilarious 
                        caricature of myself.
                    </p>

                    <div class=image>
                        <figure> 
                            <img src="output/caricature/warp_1.8_dissolve_0.9.jpg", width="500">
                            <figcaption class="caption"> 
                            Caricature of My Face 
                            <br>
                            Warp: 1.8
                            <br>
                            Dissolve: 0.9
                            </figcaption>
                        </figure>
                    </div>

                <h2 id="bw"> Bells & Whistles </h2>
                    <h3 id="gender-change"> Gender Change </h3>
                        <p>
                            I managed to change my gender from male to female by morphing my face into an averaged Chinese female face. I downloaded a photo of the average Chinese female face 
                            and defined correspondences similar to part 1. Using the morph sequence from part 3, I successfully morphed my face into the average female face while recording the intemediate
                            images at each step. I tried morphing only my appearance, only my shape, and both. After visualizing all intermediate images, I have chosen the one with my face half morphed into the mean face, thus changing my gender from male to 
                            female. Here are the results.
                        </p>

                        <div class="image_container"> 
                            <div class=image>
                                <figure> 
                                    <img src="data/my_photo_small.jpg", width="200">
                                    <figcaption class="caption"> 
                                        My Face
                                    </figcaption>
                                </figure>
                            </div>
                            <div class=image>
                                <figure> 
                                    <img src="data/avg_chinese_woman.jpg", width="200">
                                    <figcaption class="caption"> 
                                        Averaged Chinese Woman Face
                                    </figcaption>
                                </figure>
                            </div>
                        </div>
                        <div class="tri"> 
                            <div class=image>
                                <figure> 
                                    <img src="output/bw-gender/me_to_female_geom.jpg", width="200">
                                    <figcaption class="caption"> 
                                        Appearance Only 
                                    </figcaption>
                                </figure>
                            </div>
                            <div class=image>
                                <figure> 
                                    <img src="output/bw-gender/me_to_female_appearance.jpg", width="200">
                                    <figcaption class="caption"> 
                                        Shape Only
                                    </figcaption>
                                </figure>
                            </div>
                            <div class=image>
                                <figure> 
                                    <img src="output/bw-gender/me_to_female_both.jpg", width="200">
                                    <figcaption class="caption"> 
                                        Both Appearance and Shape
                                    </figcaption>
                                </figure>
                            </div>
                        </div>
                    
                    <p> 
                        In my opinion, the best morphing result was with both shape and appearance as it captured the female face shape while retaining my facial details. The appearance 
                        only transformation remotely looked like me, and the shape only transformation looked too much like me.
                    </p>

                    <h3 id="pca"> PCA </h3>
                        <p>
                            To find the principle axes, I first dimension stacked all 400 gray-scaled, flattened faces from FEI to create a (360 * 260) by 400 array.
                            Then, I used `sklearn.decomposition.PCA` to find the principle components of the combined data set. Using the top 100 principle axes (axes top 100 largest
                            singular values), I transformed my face and the mean face from FEI into the an eigen space. I then simply dissolved my face into the mean face. 
                            The dissolve fractions are 1 for my face and 0.9 for the mean face. Finally, I used the inverse transformation function to restore the dissolved
                            face in the RGB space. Here are the results.
                        </p>

                        <div class="image_container"> 
                            <div class=image>
                                <figure> 
                                    <img src="output/bw-pca/eigenfaces.png", width="400">
                                    <figcaption class="caption"> 
                                        Eigenfaces of FEI faces in th eigenspace.
                                    </figcaption>
                                </figure>
                            </div>
                            <div class=image>
                                <figure> 
                                    <img src="output/bw-pca/my_face_1_mean_face_0.9.jpg", width="400">
                                    <figcaption class="caption"> 
                                        Caricature of Me
                                    </figcaption>
                                </figure>
                            </div>
                        </div>

                        <p> 
                            Compared with the RGB space caricature from part 5, the caricature through the Eigenspace was less dramatic and more blend, as it did not have any color. However, the 
                            morphing process is significantly faster than using the RGB space.
                        </p>

            </div>
        </div>
    </body>
</html>
